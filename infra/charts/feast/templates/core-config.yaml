apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "feast.core.name" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    app: {{ template "feast.name" . }}
    component: core
    chart: {{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
data:
  config: |

    # Please see gojek/feast/core/src/main/resources/application.yml for an explanation of config

    grpc:
      port: {{ .Values.core.service.grpc.port }}
      enable-reflection: {{ .Values.core.enableReflection }}

    feast:
      store:
        serving-type: {{ .Values.core.store.serving.type }}
        serving-options:
          host: {{ .Values.core.store.serving.options.redis.host }}
          port: {{ .Values.core.store.serving.options.redis.port }}
          subscriptions: ".*:>0"
        warehouse-type: ""
      jobs:
        runner: {{ .Values.core.jobs.runner }}
        options: {{ .Values.core.jobs.options }}
      stream:
        # Feature stream type. Only kafka is supported.
        type: {{ .Values.stream.type }}
        # Feature stream options.
        options:
          bootstrapServers: {{ .Values.stream.options.bootstrapServers }}
          replicationFactor: {{ .Values.stream.options.replicationFactor }}
          partitions: {{ .Values.stream.options.partitions }}
      statsd:
        host: {{ .Values.statsd.host }}
        port: {{ .Values.statsd.port }}

    spring:
      jpa:
        properties.hibernate.format_sql: true
        hibernate.naming.physical-strategy=org.hibernate.boot.model.naming: PhysicalNamingStrategyStandardImpl
        hibernate.ddl-auto: update
      datasource:
        url: jdbc:postgresql://{{ .Values.core.postgres.host }}:{{ .Values.core.postgres.port }}/{{ .Values.core.postgres.database }}
        username: {{ .Values.core.postgres.username }}
        password: {{ .Values.core.postgres.password }}

    management:
      metrics:
        export:
          simple:
            enabled: false
          statsd:
            enabled: true
            host: {{ .Values.statsd.host }}
            port: {{ .Values.statsd.port }}