steps:
- name: maven:3.6.0-jdk-8-slim
  args: ['mvn', 'clean', 'install', '-DskipTests', '-Drevision=0.0.0']
  id: build-jars

- name: "gcr.io/cloud-builders/docker"
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/feast-core:0.0.0', '-t', 'gcr.io/$PROJECT_ID/feast-core:latest', '--build-arg', 'RELEASE=0.0.0', '-f', './docker/core/Dockerfile', '.']
  id: docker-core
  waitFor: 
  - build-jars

- name: "gcr.io/cloud-builders/docker"
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/feast-serving:0.0.0', '-t', 'gcr.io/$PROJECT_ID/feast-serving:latest', '--build-arg', 'RELEASE=0.0.0', '-f', './docker/serving/Dockerfile', '.']
  id: docker-serving
  waitFor: 
  
  - build-jars

timeout: 1200s
images: ['gcr.io/$PROJECT_ID/feast-core:latest', 'gcr.io/$PROJECT_ID/feast-core:0.0.0', 'gcr.io/$PROJECT_ID/feast-serving:latest', 'gcr.io/$PROJECT_ID/feast-serving:0.0.0']