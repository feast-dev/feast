FROM registry.access.redhat.com/ubi8/python-311:1

ARG ARROW_VERSION=17.0.0

USER 0
RUN yum install -y ninja-build llvm-devel llvm-libs llvm-toolset ncurses-devel rust
RUN wget https://github.com/apache/arrow/archive/refs/tags/apache-arrow-${ARROW_VERSION}.tar.gz && \
    tar xvfz apache-arrow-${ARROW_VERSION}.tar.gz && \
    cd arrow-apache-arrow-${ARROW_VERSION}/cpp && \
    cmake \
    -DARROW_COMPUTE=ON \
    -DARROW_ACERO=ON \
    -DARROW_CSV=ON \
    -DARROW_DATASET=ON \
    -DARROW_FILESYSTEM=ON \
    -DARROW_FLIGHT=ON \
    -DARROW_FLIGHT_SQL=ON \
    -DARROW_GANDIVA=ON \
    -DARROW_HDFS=ON \
    -DARROW_JSON=ON \
    -DARROW_PARQUET=ON \
    -DARROW_S3=ON \
    -DARROW_WITH_UTF8PROC=ON \
    -DARROW_TENSORFLOW=ON \
    -DARROW_PARQUET=ON \
    . && \
    cmake --build . && \
    cmake --install . && \
    cd ${APP_ROOT}/src && \
    rm -rf *apache-arrow*

RUN yum install -y cargo
ARG ANYHOW_VERSION=1.0.97
RUN wget https://github.com/dtolnay/anyhow/archive/refs/tags/${ANYHOW_VERSION}.tar.gz && \
    tar xvfz ${ANYHOW_VERSION}.tar.gz && \
    cd anyhow-${ANYHOW_VERSION} && \
    cargo install --offline --path .

USER 1001
